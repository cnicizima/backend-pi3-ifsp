// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int      @unique @default(autoincrement())
  cpf        String   @id @db.Char(11)
  nome       String   @db.VarChar(100)
  email      String   @unique @db.VarChar(150)
  sexo       String?  @db.VarChar(10)
  telefone   String   @db.VarChar(15)
  nascimento DateTime @db.Date
  password   String   @db.VarChar(255)
  isAdmin    Boolean  @default(false)
  avatar     String?  @db.Text // url da imagem. Se for postar foto, precisa verificar o tipo certo.

  enderecos  Endereco[]
  pedidos    Pedido[]
  avaliacoes Avaliacao[]
  favoritos  Favoritos[]
  mensagens  Message[]
}

model Endereco {
  idEndereco  Int     @id @default(autoincrement())
  usuarioCpf  String  @db.Char(11)
  apelido     String  @db.VarChar(50)
  cep         String  @db.Char(8)
  rua         String  @db.VarChar(255)
  numero      String  @db.VarChar(10)
  complemento String? @db.VarChar(100)
  cidade      String  @db.VarChar(100)
  estado      String  @db.Char(2)

  usuario User @relation(fields: [usuarioCpf], references: [cpf])

  pedidos Pedido[]
}

model Pedido {
  idPedido   Int      @id @default(autoincrement())
  usuarioCpf String   @db.Char(11)
  enderecoId Int
  valorTotal Decimal  @db.Decimal(10, 2)
  status     String   @db.VarChar(20)
  dataCompra DateTime @default(now())
  idCupom    Int?

  usuario   User       @relation(fields: [usuarioCpf], references: [cpf])
  endereco  Endereco   @relation(fields: [enderecoId], references: [idEndereco])
  pagamento Pagamento?
  cupom     Cupom?     @relation(fields: [idCupom], references: [idCupom])

  produtos PedidoProduto[]
}

model Pagamento {
  idPagamento   Int       @id @default(autoincrement())
  pedidoId      Int       @unique
  metodo        String    @db.VarChar(10)
  status        String    @db.VarChar(10)
  valorPago     Decimal   @db.Decimal(10, 2)
  dataPagamento DateTime?

  pedido Pedido @relation(fields: [pedidoId], references: [idPedido])
}

model Produto {
  idProduto      Int     @id @default(autoincrement())
  fotoVinho      String? @db.Text //url da foto
  nome           String  @db.VarChar(150)
  descricao      String  @db.Text
  preco          Decimal @db.Decimal(10, 2)
  classificacao  Decimal @db.Decimal(3, 2)
  categoria      String  @db.VarChar(50)
  gustativo      String? @db.Text
  olfativo       String? @db.Text
  regiao         String? @db.VarChar(100)
  amadurecimento String? @db.Text
  analises       String? @db.Text
  uvas           String? @db.VarChar(255)
  temperatura    String? @db.VarChar(50)

  estoque    Estoque?
  avaliacoes Avaliacao[]
  favoritos  Favoritos[]
  pedidos    PedidoProduto[]
}

model Estoque {
  idEstoque  Int @id @default(autoincrement())
  produtoId  Int @unique
  quantidade Int @default(0) @db.Int

  produto Produto @relation(fields: [produtoId], references: [idProduto])
}

model PedidoProduto {
  idPedidoProduto Int     @id @default(autoincrement())
  pedidoId        Int
  produtoId       Int
  quantidade      Int     @db.Int
  valorItem       Decimal @db.Decimal(10, 2)

  pedido  Pedido  @relation(fields: [pedidoId], references: [idPedido])
  produto Produto @relation(fields: [produtoId], references: [idProduto])
}

model Favoritos {
  idFavorito Int    @id @default(autoincrement())
  usuarioCpf String @db.Char(11)
  produtoId  Int

  usuario User    @relation(fields: [usuarioCpf], references: [cpf])
  produto Produto @relation(fields: [produtoId], references: [idProduto])
}

model Avaliacao {
  idAvaliacao Int      @id @default(autoincrement())
  usuarioCpf  String   @db.Char(11)
  produtoId   Int
  avaliacao   Decimal  @db.Decimal(2, 1)
  conteudo    String?  @db.Text
  dataCriacao DateTime @default(now())

  usuario User    @relation(fields: [usuarioCpf], references: [cpf])
  produto Produto @relation(fields: [produtoId], references: [idProduto])
}

model Message {
  idMessage  Int      @id @default(autoincrement())
  usuarioCpf String   @db.Char(11)
  assunto    String   @db.VarChar(255)
  conteudo   String   @db.Text
  dataEnvio  DateTime @default(now())

  usuario User @relation(fields: [usuarioCpf], references: [cpf])
}

model Cupom {
  idCupom  Int      @id @default(autoincrement())
  codigo   String   @unique @db.VarChar(50)
  desconto Decimal  @db.Decimal(5, 2)
  pedidos  Pedido[]
}
